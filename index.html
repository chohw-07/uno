<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UNO ì¹´ë“œ ê²Œì„</title>
  <!-- SimplePeer ë¼ì´ë¸ŒëŸ¬ë¦¬ (CDN) -->
  <script src="https://unpkg.com/simple-peer@9.11.1/simplepeer.min.js"></script>
  <!-- QR ì½”ë“œ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
  <style>
    :root {
      --primary-color: #e74c3c;
      --secondary-color: #3498db;
      --background-color: #0b6623;
      --card-back-color: #2c3e50;
      --text-color: #ecf0f1;
      --menu-bg: linear-gradient(135deg, #8B5A2B, #A0522D);
      --button-color: #27ae60;
      --button-hover: #1e8449;
      --card-shadow: 0 4px 8px rgba(0,0,0,0.3);
      --toast-bg: rgba(0, 0, 0, 0.85);
      --red-card: linear-gradient(135deg, #e74c3c, #c0392b);
      --yellow-card: linear-gradient(135deg, #f1c40f, #f39c12);
      --green-card: linear-gradient(135deg, #2ecc71, #27ae60);
      --blue-card: linear-gradient(135deg, #3498db, #2980b9);
      --wild-card: linear-gradient(135deg, #9b59b6, #8e44ad);
      --card-border-radius: 12px;
      --transition-speed: 0.3s;
      --table-highlight: rgba(255, 255, 255, 0.1);
    }

    /* ìƒ‰ì•½ì ëª¨ë“œìš© ë³€ìˆ˜ (í™œì„±í™”ì‹œ ëŒ€ì²´) */
    .color-blind-mode {
      --red-card: linear-gradient(135deg, #e67e22, #d35400);
      --yellow-card: linear-gradient(135deg, #f1c40f, #f39c12);
      --green-card: linear-gradient(135deg, #1abc9c, #16a085);
      --blue-card: linear-gradient(135deg, #3498db, #2980b9);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(ellipse at center, var(--background-color) 0%, #004d23 100%);
      color: var(--text-color);
      min-height: 100vh;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem;
      background-color: rgba(0, 0, 0, 0.3);
    }

    .game-title {
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
      text-align: center;
      margin: 0;
      flex-grow: 1;
    }

    .settings-button {
      background: transparent;
      border: none;
      color: var(--text-color);
      font-size: 1.5rem;
      cursor: pointer;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s;
    }

    .settings-button:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* ë©”ì¸ ë©”ë‰´ ìŠ¤íƒ€ì¼ */
    #menuScreen {
      background: var(--menu-bg);
      padding: 2rem;
      border-radius: 16px;
      max-width: 600px;
      width: 90%;
      margin: 5vh auto;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6);
      text-align: center;
      transform: translateY(0);
      opacity: 1;
      transition: transform 0.5s, opacity 0.5s;
    }

    #menuScreen.hidden {
      transform: translateY(-20px);
      opacity: 0;
      pointer-events: none;
    }

    .menu-title {
      font-size: 2.5rem;
      margin-bottom: 1.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .menu-description {
      font-size: 1.1rem;
      margin-bottom: 2rem;
      line-height: 1.5;
    }

    .button-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .menu-button {
      padding: 1rem 1.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      background: var(--button-color);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }

    .menu-button:hover {
      background: var(--button-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(0, 0, 0, 0.3);
    }

    .menu-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .menu-button i {
      font-size: 1.4rem;
    }

    .menu-button.secondary {
      background: #7f8c8d;
    }

    .menu-button.secondary:hover {
      background: #6c7a7d;
    }

    /* ëª¨ë“œ ì„ íƒ ë¼ë””ì˜¤ ë²„íŠ¼ */
    .game-modes {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .mode-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 1.5rem;
      border-radius: 10px;
      width: 180px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid transparent;
    }

    .mode-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .mode-card.selected {
      border-color: var(--primary-color);
      background: rgba(0, 0, 0, 0.5);
    }

    .mode-icon {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      color: var(--text-color);
    }

    .mode-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .mode-desc {
      font-size: 0.9rem;
      color: #ccc;
    }

    .difficulty-select {
      display: none;
      margin-top: 1rem;
    }

    .difficulty-select.visible {
      display: block;
      animation: fadeIn 0.3s;
    }

    .difficulty-options {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .difficulty-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s;
    }

    .difficulty-btn.selected {
      background: var(--secondary-color);
    }

    /* ì‹œê·¸ë„ë§ íŒ¨ë„ */
    #signalPanel {
      display: none;
      max-width: 800px;
      width: 90%;
      margin: 2rem auto;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6);
      text-align: center;
    }

    #signalInstructions {
      font-size: 1.1rem;
      margin-bottom: 1rem;
      line-height: 1.5;
    }

    .signal-tabs {
      display: flex;
      margin-bottom: 1rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .signal-tab {
      padding: 0.8rem 1.5rem;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .signal-tab.active {
      border-bottom-color: var(--primary-color);
      font-weight: bold;
    }

    .signal-content {
      display: none;
    }

    .signal-content.active {
      display: block;
      animation: fadeIn 0.3s;
    }

    #signalData {
      width: 100%;
      height: 120px;
      margin: 1rem 0;
      padding: 0.8rem;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      color: var(--text-color);
      resize: none;
      font-family: monospace;
    }

    #qrContainer {
      max-width: 200px;
      margin: 1rem auto;
      background: white;
      padding: 1rem;
      border-radius: 8px;
    }

    .copy-button {
      padding: 0.5rem 1rem;
      background: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: 4px;
      color: var(--text-color);
      cursor: pointer;
      transition: all 0.3s;
      margin-right: 0.5rem;
    }

    .copy-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .connection-status {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 8px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .status-connecting {
      background: rgba(241, 196, 15, 0.3);
      color: #f1c40f;
    }

    .status-connected {
      background: rgba(46, 204, 113, 0.3);
      color: #2ecc71;
    }

    .status-error {
      background: rgba(231, 76, 60, 0.3);
      color: #e74c3c;
    }

    .loader {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--text-color);
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
    #gameContainer {
      display: none;
      max-width: 100%;
      width: 100%;
      height: calc(100vh - 70px);
      box-sizing: border-box;
      margin: 0 auto;
      padding: 1rem;
      position: relative;
    }

    /* ê²Œì„ í™”ë©´ ë ˆì´ì•„ì›ƒ */
    .game-layout {
      display: grid;
      grid-template-rows: auto 1fr auto;
      height: 100%;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* ìƒëŒ€ë°© ì˜ì—­ */
    .opponent-area {
      padding: 1rem;
      text-align: center;
      position: relative;
    }

    #opponentInfo {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .opponent-status {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background-color: #e74c3c;
      display: inline-block;
      margin-right: 0.5rem;
    }

    .opponent-status.active {
      background-color: #2ecc71;
    }

    .opponent-status.thinking {
      animation: blink 1.5s infinite;
    }

    .opponent-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #34495e;
      margin: 0 auto 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      overflow: hidden;
    }

    .opponent-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .opponent-cards {
      display: flex;
      justify-content: center;
      min-height: 60px;
      margin-top: 0.5rem;
    }

    .opponent-card {
      width: 40px;
      height: 60px;
      background: var(--card-back-color);
      border-radius: var(--card-border-radius);
      margin: 0 -15px;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s;
      position: relative;
      transform-origin: center bottom;
    }

    .opponent-card:nth-child(even) {
      transform: rotate(-2deg);
    }

    .opponent-card:nth-child(odd) {
      transform: rotate(2deg);
    }

    .opponent-card:hover {
      transform: translateY(-5px);
      z-index: 5;
    }

    /* í…Œì´ë¸” ì˜ì—­ */
    .table-area {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 1rem;
    }

    .table-felt {
      position: absolute;
      top: 20%;
      left: 10%;
      right: 10%;
      bottom: 20%;
      background-color: var(--table-highlight);
      border-radius: 50%;
      z-index: -1;
    }

    #table {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      position: relative;
      margin: 1rem 0;
      width: 100%;
    }

    .pile-wrapper {
      position: relative;
      perspective: 1000px;
    }

    .pile-label {
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      text-align: center;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    #drawPile, #discardPile {
      width: 80px;
      height: 120px;
      position: relative;
      transition: all 0.3s;
    }

    #drawPile:hover {
      transform: scale(1.05);
    }

    .pile-count {
      position: absolute;
      bottom: -20px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.9rem;
      font-weight: bold;
    }

    /* ìƒ‰ìƒ ì„ íƒê¸° */
    #colorSelector {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 1rem;
      border-radius: 12px;
      z-index: 100;
      animation: fadeIn 0.3s;
    }

    .color-title {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      text-align: center;
    }

    .color-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    .color-option {
      width: 70px;
      height: 70px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-red {
      background: var(--red-card);
    }

    .color-yellow {
      background: var(--yellow-card);
    }

    .color-green {
      background: var(--green-card);
    }

    .color-blue {
      background: var(--blue-card);
    }

    /* í˜„ì¬ í„´ í‘œì‹œ */
    #currentTurnDisplay {
      padding: 0.5rem 1rem;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      font-weight: bold;
      text-align: center;
      margin: 1rem 0;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .turn-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--primary-color);
    }

    .turn-indicator.active {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.3);
        opacity: 0.7;
      }
      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* ë©”ì‹œì§€ ì˜ì—­ */
    #message {
      font-size: 1.2rem;
      padding: 0.8rem 1.5rem;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 8px;
      text-align: center;
      margin: 1rem 0;
      transition: all 0.3s;
    }

    #message.highlight {
      background: rgba(231, 76, 60, 0.3);
      transform: scale(1.05);
    }

    /* ì•¡ì…˜ ë²„íŠ¼ */
    .game-actions {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1rem 0;
    }

    .action-button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-color);
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-button:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .action-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .action-button.uno-button {
      background: var(--primary-color);
    }

    .action-button.uno-button:hover {
      background: #c0392b;
    }

    /* í”Œë ˆì´ì–´ í•¸ë“œ ì˜ì—­ */
    .player-area {
      padding: 1rem;
      position: relative;
    }

    #playerHand {
      position: relative;
      min-height: 150px;
      margin: 0 auto;
      display: flex;
      justify-content: center;
      perspective: 1000px;
    }

    .hand-wrapper {
      position: relative;
      min-height: 150px;
      max-width: 90%;
      overflow-x: auto;
      margin: 0 auto;
      -ms-overflow-style: none;
      scrollbar-width: none;
      padding: 0.5rem;
    }

    .hand-wrapper::-webkit-scrollbar {
      display: none;
    }

    /* ì¹´ë“œ ë””ìì¸ */
    .card {
      width: 80px;
      height: 120px;
      border-radius: var(--card-border-radius);
      position: absolute;
      box-shadow: var(--card-shadow);
      background: linear-gradient(to bottom, #fff, #eee);
      border: 2px solid rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 2rem;
      cursor: pointer;
      user-select: none;
      transition: transform var(--transition-speed), box-shadow var(--transition-speed);
      transform-origin: center bottom;
      color: white;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }

    .card-player {
      position: relative;
      margin: 0 -15px;
      display: inline-block;
      transition: transform 0.3s, margin 0.3s;
    }

    .card-player:hover {
      transform: translateY(-20px) scale(1.1);
      z-index: 10;
      margin: 0 5px;
    }

    .card.can-play {
      box-shadow: 0 0 0 3px #f1c40f, var(--card-shadow);
      animation: canPlay 1.5s infinite;
    }

    @keyframes canPlay {
      0%, 100% {
        box-shadow: 0 0 0 2px #f1c40f, var(--card-shadow);
      }
      50% {
        box-shadow: 0 0 10px 2px #f1c40f, var(--card-shadow);
      }
    }

    /* ì¹´ë“œ ìƒ‰ìƒ */
    .card.red {
      background: var(--red-card);
    }

    .card.yellow {
      background: var(--yellow-card);
    }

    .card.green {
      background: var(--green-card);
    }

    .card.blue {
      background: var(--blue-card);
    }

    .card.wild {
      background: var(--wild-card);
    }

    /* ì¹´ë“œ ë‚´ë¶€ ë””ìì¸ */
    .card-content {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
    }

    .card-corners {
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 1rem;
    }

    .card-corners-br {
      position: absolute;
      bottom: 5px;
      right: 5px;
      font-size: 1rem;
      transform: rotate(180deg);
    }

    .card-back {
      background: var(--card-back-color);
      border: 2px solid rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .card-back:after {
      content: "UNO";
      font-size: 1.5rem;
      transform: rotate(-45deg);
      position: absolute;
      background: var(--primary-color);
      padding: 0.3rem 1.5rem;
    }

    /* í”Œë ˆì´ ì• ë‹ˆë©”ì´ì…˜ */
    .play-animation {
      animation: playCardAnim 0.5s ease-out;
    }

    @keyframes playCardAnim {
      0% {
        transform: translate(0, 0) rotate(0deg);
        opacity: 0.5;
      }
      50% {
        transform: translate(0, -30px) rotate(10deg);
        opacity: 1;
      }
      100% {
        transform: translate(0, 0) rotate(0deg);
        opacity: 1;
      }
    }

    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
    #toastContainer {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }

    .toast {
      background: var(--toast-bg);
      padding: 1rem 1.5rem;
      margin-bottom: 0.8rem;
      border-radius: 8px;
      color: var(--text-color);
      font-size: 1rem;
      animation: fadeInOut 3s forwards;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      gap: 0.8rem;
      max-width: 320px;
    }

    .toast-icon {
      font-size: 1.3rem;
      flex-shrink: 0;
    }

    .toast-info {
      color: #3498db;
    }

    .toast-success {
      color: #2ecc71;
    }

    .toast-warning {
      color: #f1c40f;
    }

    .toast-error {
      color: #e74c3c;
    }

    @keyframes fadeInOut {
      0% {
        opacity: 0;
        transform: translateX(50px);
      }
      10% {
        opacity: 1;
        transform: translateX(0);
      }
      90% {
        opacity: 1;
        transform: translateX(0);
      }
      100% {
        opacity: 0;
        transform: translateX(50px);
      }
    }

    /* ê²°ê³¼ ëª¨ë‹¬ */
    #gameResultModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s;
    }

    .modal-content {
      background: var(--menu-bg);
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      text-align: center;
      animation: scaleIn 0.3s;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .result-title {
      font-size: 2.5rem;
      margin-bottom: 1rem;
    }

    .win-message {
      color: #f1c40f;
      text-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }

    .lose-message {
      color: #e74c3c;
    }

    .result-stats {
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem;
      border-radius: 8px;
      margin: 1.5rem 0;
      text-align: left;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .stat-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f1c40f;
      opacity: 0.8;
    }

    /* ì„¤ì • ëª¨ë‹¬ */
    #settingsModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .settings-content {
      background: var(--menu-bg);
      border-radius: 16px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      animation: scaleIn 0.3s;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .settings-title {
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
      text-align: center;
    }

    .settings-group {
      margin-bottom: 1.5rem;
    }

    .settings-label {
      font-size: 1.1rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      display: block;
    }

    .toggle-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 30px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 30px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 22px;
      width: 22px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--button-color);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(30px);
    }

    .volume-control {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .volume-slider {
      flex-grow: 1;
      height: 8px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      appearance: none;
    }

    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--text-color);
      cursor: pointer;
    }

    .modal-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 2rem;
    }

    /* ë°˜ì‘í˜• ë””ìì¸ */
    @media (max-width: 768px) {
      .game-title {
        font-size: 1.5rem;
      }

      .menu-title {
        font-size: 2rem;
      }

      .game-modes {
        flex-direction: column;
        align-items: center;
      }

      .mode-card {
        width: 100%;
        max-width: 280px;
      }

      #table {
        gap: 1rem;
      }

      .card {
        width: 70px;
        height: 105px;
        font-size: 1.8rem;
      }

      #drawPile, #discardPile {
        width: 70px;
        height: 105px;
      }

      .opponent-card {
        width: 35px;
        height: 53px;
        margin: 0 -12px;
      }

      .card-player {
        margin: 0 -25px;
      }

      .card-player:hover {
        margin: 0 -10px;
      }

      .card-corners, .card-corners-br {
        font-size: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .card {
        width: 60px;
        height: 90px;
        font-size: 1.5rem;
      }

      #drawPile, #discardPile {
        width: 60px;
        height: 90px;
      }

      .opponent-card {
        width: 30px;
        height: 45px;
        margin: 0 -10px;
      }

      .game-actions {
        flex-wrap: wrap;
      }

      .card-player {
        margin: 0 -28px;
      }

      .card-player:hover {
        margin: 0 -15px;
      }
    }

    /* ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes scaleIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    @keyframes blink {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
    }

    /* ì•„ì´ì½˜ í°íŠ¸ (ê°„ë‹¨í•œ ëŒ€ìš©) */
    .icon {
      font-family: Arial, sans-serif;
      font-style: normal;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <header>
    <button id="settingsBtn" class="settings-button">âš™ï¸</button>
    <h1 class="game-title">UNO ì¹´ë“œ ê²Œì„</h1>
    <div style="width: 40px;"></div> <!-- ê· í˜•ì„ ìœ„í•œ ë¹ˆ ê³µê°„ -->
  </header>

  <!-- ì´ˆê¸° ë©”ë‰´ (ê²Œì„ ëª¨ë“œ ì„ íƒ) -->
  <div id="menuScreen">
    <h2 class="menu-title">UNO ì¹´ë“œ ê²Œì„</h2>
    <p class="menu-description">ì¹œêµ¬ì™€ í•¨ê»˜ í”Œë ˆì´í•˜ê±°ë‚˜ AIì™€ ëŒ€ê²°í•˜ì„¸ìš”!</p>
    
    <div class="game-modes">
      <div class="mode-card" data-mode="ai">
        <div class="mode-icon">ğŸ¤–</div>
        <div class="mode-title">AI ëŒ€ì „</div>
        <div class="mode-desc">ì¸ê³µì§€ëŠ¥ ìƒëŒ€ì™€ 1:1 ëŒ€ê²°</div>
      </div>
      <div class="mode-card" data-mode="p2p">
        <div class="mode-icon">ğŸ‘¥</div>
        <div class="mode-title">ì¹œêµ¬ì™€ í”Œë ˆì´</div>
        <div class="mode-desc">P2P ì—°ê²°ë¡œ ì›ê²© í”Œë ˆì´</div>
      </div>
    </div>

    <div id="aiDifficultySelect" class="difficulty-select">
      <div class="settings-label">ë‚œì´ë„ ì„ íƒ:</div>
      <div class="difficulty-options">
        <button class="difficulty-btn" data-difficulty="easy">ì‰¬ì›€</button>
        <button class="difficulty-btn selected" data-difficulty="medium">ë³´í†µ</button>
        <button class="difficulty-btn" data-difficulty="hard">ì–´ë ¤ì›€</button>
      </div>
    </div>

    <div id="p2pRoleSelect" class="difficulty-select">
      <div class="settings-label">ì—­í•  ì„ íƒ:</div>
      <div class="difficulty-options">
        <button class="difficulty-btn selected" data-role="host">ë°© ë§Œë“¤ê¸°</button>
        <button class="difficulty-btn" data-role="client">ë°© ì°¸ê°€í•˜ê¸°</button>
      </div>
    </div>

    <div class="button-group">
      <button id="startGameBtn" class="menu-button">
        <span class="icon">â–¶ï¸</span> ê²Œì„ ì‹œì‘
      </button>
      <button id="rulesBtn" class="menu-button secondary">
        <span class="icon">ğŸ“‹</span> ê²Œì„ ê·œì¹™
      </button>
    </div>
  </div>

  <!-- ì‹œê·¸ë„ë§ íŒ¨ë„ (P2P ì—°ê²°ìš©) -->
  <div id="signalPanel">
    <div id="signalInstructions"></div>
    
    <div class="signal-tabs">
      <div class="signal-tab active" data-tab="text">í…ìŠ¤íŠ¸ ì½”ë“œ</div>
      <div class="signal-tab" data-tab="qr">QR ì½”ë“œ</div>
    </div>
    
    <div class="signal-content active" data-content="text">
      <textarea id="signalData" placeholder="ìƒëŒ€ë°©ì˜ ì—°ê²° ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
      <button id="copySignalBtn" class="copy-button">ë³µì‚¬í•˜ê¸°</button>
      <button id="sendSignalBtn" class="menu-button">ì „ì†¡</button>
    </div>
    
    <div class="signal-content" data-content="qr">
      <div id="qrContainer"></div>
      <p>QR ì½”ë“œë¥¼ ìƒëŒ€ë°©ì—ê²Œ ë³´ì—¬ì£¼ì„¸ìš”</p>
    </div>
    
    <div id="connectionStatus" class="connection-status status-connecting">
      <div class="loader"></div> ì—°ê²° ëŒ€ê¸° ì¤‘...
    </div>
    
    <button id="cancelConnectionBtn" class="menu-button secondary">ì—°ê²° ì·¨ì†Œ</button>
  </div>

  <!-- ê²Œì„ ì»¨í…Œì´ë„ˆ -->
  <div id="gameContainer">
    <div class="game-layout">
      <!-- ìƒëŒ€ë°© ì˜ì—­ -->
      <div class="opponent-area">
        <div class="opponent-avatar">ğŸ¤–</div>
        <div id="opponentInfo">ìƒëŒ€ ì¹´ë“œ: 7ì¥</div>
        <div class="opponent-cards" id="opponentCards"></div>
      </div>
      
      <!-- í…Œì´ë¸” ì˜ì—­ -->
      <div class="table-area">
        <div class="table-felt"></div>
        
        <div id="currentTurnDisplay">
          <span class="turn-indicator"></span>
          <span id="turnText">ìƒëŒ€ ì°¨ë¡€</span>
        </div>
        
        <div id="table">
          <div class="pile-wrapper">
            <div class="pile-label">ë“œë¡œìš° íŒŒì¼</div>
            <div id="drawPile"></div>
            <div class="pile-count" id="deckCount">52ì¥</div>
          </div>
          <div class="pile-wrapper">
            <div class="pile-label">ë²„ë¦¼ íŒŒì¼</div>
            <div id="discardPile"></div>
          </div>
        </div>
        
        <div id="message">ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...</div>
        
        <div class="game-actions">
          <button id="drawCardBtn" class="action-button">
            <span class="icon">ğŸƒ</span> ì¹´ë“œ ë½‘ê¸°
          </button>
          <button id="unoBtn" class="action-button uno-button" disabled>
            <span class="icon">ğŸ”Š</span> UNO!
          </button>
          <button id="passBtn" class="action-button" disabled>
            <span class="icon">â­ï¸</span> í„´ ë„˜ê¸°ê¸°
          </button>
        </div>
      </div>
      
      <!-- í”Œë ˆì´ì–´ ì˜ì—­ -->
      <div class="player-area">
        <div class="hand-wrapper">
          <div id="playerHand"></div>
        </div>
      </div>
    </div>
    
    <!-- ìƒ‰ìƒ ì„ íƒê¸° -->
    <div id="colorSelector">
      <div class="color-title">ìƒ‰ìƒì„ ì„ íƒí•˜ì„¸ìš”</div>
      <div class="color-options">
        <div class="color-option color-red" data-color="red"></div>
        <div class="color-option color-yellow" data-color="yellow"></div>
        <div class="color-option color-green" data-color="green"></div>
        <div class="color-option color-blue" data-color="blue"></div>
      </div>
    </div>
  </div>

  <!-- ê²Œì„ ê²°ê³¼ ëª¨ë‹¬ -->
  <div id="gameResultModal">
    <div class="modal-content">
      <h2 class="result-title win-message">ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!</h2>
      <p>ì¶•í•˜í•©ë‹ˆë‹¤! ìƒëŒ€ë³´ë‹¤ ë¨¼ì € ëª¨ë“  ì¹´ë“œë¥¼ ë‚´ì…¨ìŠµë‹ˆë‹¤.</p>
      
      <div class="result-stats">
        <div class="stat-item">
          <span>ê²Œì„ ì‹œê°„:</span>
          <span id="gameTime">3ë¶„ 20ì´ˆ</span>
        </div>
        <div class="stat-item">
          <span>ì‚¬ìš©í•œ ì¹´ë“œ:</span>
          <span id="cardsPlayed">15ì¥</span>
        </div>
        <div class="stat-item">
          <span>ë½‘ì€ ì¹´ë“œ:</span>
          <span id="cardsDrawn">7ì¥</span>
        </div>
      </div>
      
      <div class="button-group">
        <button id="playAgainBtn" class="menu-button">
          <span class="icon">ğŸ”„</span> ë‹¤ì‹œ í”Œë ˆì´
        </button>
        <button id="backToMenuBtn" class="menu-button secondary">
          <span class="icon">ğŸ </span> ë©”ì¸ ë©”ë‰´
        </button>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settingsModal">
    <div class="settings-content">
      <h2 class="settings-title">ê²Œì„ ì„¤ì •</h2>
      
      <div class="settings-group">
        <div class="toggle-container">
          <span class="settings-label">íš¨ê³¼ìŒ</span>
          <label class="toggle-switch">
            <input type="checkbox" id="soundToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="toggle-container">
          <span class="settings-label">ë°°ê²½ ìŒì•…</span>
          <label class="toggle-switch">
            <input type="checkbox" id="musicToggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="toggle-container">
          <span class="settings-label">ìƒ‰ì•½ì ëª¨ë“œ</span>
          <label class="toggle-switch">
            <input type="checkbox" id="colorBlindToggle">
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <div class="volume-control">
          <span class="settings-label">ë³¼ë¥¨</span>
          <input type="range" id="volumeSlider" class="volume-slider" min="0" max="100" value="70">
          <span id="volumeValue">70%</span>
        </div>
      </div>
      
      <div class="modal-buttons">
        <button id="closeSettingsBtn" class="menu-button">
          <span class="icon">âœ“</span> ì ìš©
        </button>
      </div>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
  <div id="toastContainer"></div>

  <script>
    /* ========== ê²Œì„ ì„¤ì • ë° ìƒíƒœ ë³€ìˆ˜ ========== */
    // ê²Œì„ ëª¨ë“œ ë° ì„¤ì •
    let gameMode = 'ai'; // 'ai' ë˜ëŠ” 'p2p'
    let aiDifficulty = 'medium'; // 'easy', 'medium', 'hard'
    let p2pRole = 'host'; // 'host' ë˜ëŠ” 'client'
    let colorBlindMode = false;
    
    // ê²Œì„ ìƒíƒœ ë³€ìˆ˜
    let deck = [];
    let discardPile = [];
    let myHand = [];
    let opponentHand = []; // AI ëª¨ë“œì—ì„œë§Œ ì‚¬ìš©
    let opponentCardCount = 0;
    let currentTurn = 'player'; // 'player' ë˜ëŠ” 'opponent'
    let currentColor = '';
    let currentValue = '';
    let gameStarted = false;
    let lastCardDrawn = false;
    let canCallUno = false;
    let unoWasCalled = false;
    let gameEndTime = null;
    let cardsPlayedCount = 0;
    let cardsDrawnCount = 0;
    
    // ê²Œì„ íƒ€ì´ë¨¸
    let gameTimer = null;
    let gameStartTime = null;
    let gameDuration = 0;
    
    // P2P ì—°ê²° ê´€ë ¨
    let peer = null;
    let connectionEstablished = false;
    let reconnectAttempts = 0;
    const MAX_RECONNECT_ATTEMPTS = 3;
    
    // ì„¤ì •
    let soundEnabled = true;
    let musicEnabled = false;
    let volumeLevel = 70;
    
    // DOM ìš”ì†Œ ì°¸ì¡°
    const menuScreen = document.getElementById('menuScreen');
    const signalPanel = document.getElementById('signalPanel');
    const gameContainer = document.getElementById('gameContainer');
    const settingsModal = document.getElementById('settingsModal');
    const gameResultModal = document.getElementById('gameResultModal');
    const colorSelector = document.getElementById('colorSelector');
    
    // ì‚¬ìš´ë“œ íš¨ê³¼ (ë°ì´í„° URI)
    const sounds = {
      cardPlay: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA"),
      cardDraw: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA"),
      uno: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA"),
      win: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA"),
      lose: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA"),
      warning: new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA")
    };
    
    // ë°°ê²½ ìŒì•…
    const bgMusic = new Audio("data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YRAAAACAgICAgICAgICAgICAgICAgICAgICA");
    bgMusic.loop = true;
    
    // ëª¨ë“  ì‚¬ìš´ë“œ ê°ì²´ ë³¼ë¥¨ ì„¤ì • í•¨ìˆ˜
    function updateVolume() {
      const volume = volumeLevel / 100;
      for (const sound in sounds) {
        sounds[sound].volume = volume;
      }
      bgMusic.volume = volume * 0.7; // ë°°ê²½ ìŒì•…ì€ ì•½ê°„ ë” ì‘ê²Œ
    }
    
    // ì‚¬ìš´ë“œ ì¬ìƒ í•¨ìˆ˜
    function playSound(sound) {
      if (soundEnabled) {
        sounds[sound].currentTime = 0;
        sounds[sound].play().catch(e => console.log('Sound play error:', e));
      }
    }
    
    /* ========== ìƒ‰ìƒ, ì¹´ë“œ íƒ€ì… ë°ì´í„° ========== */
    const colors = ["red", "yellow", "green", "blue"];
    const numbers = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
    const specialTypes = ["skip", "reverse", "draw2"];
    const wildTypes = ["wild", "draw4"];
    
    // ì¹´ë“œ ì•„ì´ì½˜ (ìˆ«ìëŠ” ê·¸ëŒ€ë¡œ, íŠ¹ìˆ˜/ì™€ì¼ë“œ ì¹´ë“œì— ì•„ì´ì½˜ ì ìš©)
    function getCardIcon(card) {
      if (card.type === "number") return card.value;
      if (card.type === "special") {
        if (card.value === "skip") return "ğŸš«";
        if (card.value === "reverse") return "ğŸ”„";
        if (card.value === "draw2") return "+2";
      }
      if (card.type === "wild") {
        if (card.value === "wild") return "â˜…";
        if (card.value === "draw4") return "+4";
      }
      return card.value;
    }
    
    /* ========== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ========== */
    document.addEventListener('DOMContentLoaded', function() {
      // ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ ì´ë²¤íŠ¸
      setupModeSelection();
      
      document.getElementById('startGameBtn').addEventListener('click', () => {
        if (gameMode === 'ai') {
          startAIGame();
        } else {
          setupP2PConnection();
        }
      });
      
      document.getElementById('rulesBtn').addEventListener('click', showRules);
      document.getElementById('settingsBtn').addEventListener('click', toggleSettingsModal);
      document.getElementById('closeSettingsBtn').addEventListener('click', saveSettings);
      
      // ê²Œì„ ë‚´ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('drawCardBtn').addEventListener('click', playerDrawCard);
      document.getElementById('unoBtn').addEventListener('click', callUno);
      document.getElementById('passBtn').addEventListener('click', passTurn);
      
      // ê²°ê³¼ ëª¨ë‹¬ ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('playAgainBtn').addEventListener('click', restartGame);
      document.getElementById('backToMenuBtn').addEventListener('click', backToMenu);
      
      // P2P ì—°ê²° ì´ë²¤íŠ¸
      document.getElementById('sendSignalBtn').addEventListener('click', sendSignalData);
      document.getElementById('copySignalBtn').addEventListener('click', copySignalData);
      document.getElementById('cancelConnectionBtn').addEventListener('click', cancelConnection);
      
      // ì‹œê·¸ë„ë§ íƒ­ ì´ë²¤íŠ¸
      setupSignalTabs();
      
      // ìƒ‰ìƒ ì„ íƒê¸° ì´ë²¤íŠ¸
      setupColorSelector();
      
      // ì„¤ì • ëª¨ë‹¬ ì´ë²¤íŠ¸
      setupSettingsControls();
      
      // ë³¼ë¥¨ ì´ˆê¸°í™”
      updateVolume();
    });
    
    /* ========== ë©”ì¸ ë©”ë‰´ ì„¤ì • ========== */
    function setupModeSelection() {
      const modeCards = document.querySelectorAll('.mode-card');
      
      modeCards.forEach(card => {
        card.addEventListener('click', () => {
          // ì„ íƒ íš¨ê³¼ ì¶”ê°€
          modeCards.forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          
          gameMode = card.dataset.mode;
          
          // í•´ë‹¹ ëª¨ë“œì˜ ì¶”ê°€ ì˜µì…˜ í‘œì‹œ
          document.getElementById('aiDifficultySelect').classList.toggle('visible', gameMode === 'ai');
          document.getElementById('p2pRoleSelect').classList.toggle('visible', gameMode === 'p2p');
        });
      });
      
      // ë‚œì´ë„ ë²„íŠ¼
      const difficultyBtns = document.querySelectorAll('.difficulty-btn[data-difficulty]');
      difficultyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          difficultyBtns.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          aiDifficulty = btn.dataset.difficulty;
        });
      });
      
      // ì—­í•  ë²„íŠ¼
      const roleBtns = document.querySelectorAll('.difficulty-btn[data-role]');
      roleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          roleBtns.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          p2pRole = btn.dataset.role;
        });
      });
    }
    
    function setupSignalTabs() {
      const tabs = document.querySelectorAll('.signal-tab');
      
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // íƒ­ í™œì„±í™”
          tabs.forEach(t => t.classList.remove('active'));
          tab.classList.add('active');
          
          // ì»¨í…ì¸  í™œì„±í™”
          const contentId = tab.dataset.tab;
          const contents = document.querySelectorAll('.signal-content');
          contents.forEach(c => c.classList.remove('active'));
          document.querySelector(`.signal-content[data-content="${contentId}"]`).classList.add('active');
          
          // QR ì½”ë“œ íƒ­ì´ë©´ QR ì½”ë“œ ìƒì„±
          if (contentId === 'qr' && document.getElementById('signalData').value) {
            generateQRCode(document.getElementById('signalData').value);
          }
        });
      });
    }
    
    function setupColorSelector() {
      const colorOptions = document.querySelectorAll('.color-option');
      
      colorOptions.forEach(option => {
        option.addEventListener('click', () => {
          const color = option.dataset.color;
          selectWildColor(color);
        });
      });
    }
    
    function setupSettingsControls() {
      // ë³¼ë¥¨ ìŠ¬ë¼ì´ë”
      const volumeSlider = document.getElementById('volumeSlider');
      const volumeValue = document.getElementById('volumeValue');
      
      volumeSlider.addEventListener('input', () => {
        volumeLevel = volumeSlider.value;
        volumeValue.textContent = `${volumeLevel}%`;
        updateVolume();
      });
      
      // í† ê¸€ ë²„íŠ¼
      document.getElementById('soundToggle').addEventListener('change', function() {
        soundEnabled = this.checked;
      });
      
      document.getElementById('musicToggle').addEventListener('change', function() {
        musicEnabled = this.checked;
        if (musicEnabled) {
          bgMusic.play().catch(e => console.log('Music play error:', e));
        } else {
          bgMusic.pause();
        }
      });
      
      document.getElementById('colorBlindToggle').addEventListener('change', function() {
        colorBlindMode = this.checked;
        document.body.classList.toggle('color-blind-mode', colorBlindMode);
      });
    }
    
    /* ========== ê²Œì„ ì‹œì‘ ë° ì´ˆê¸°í™” ========== */
    function startAIGame() {
      menuScreen.classList.add('hidden');
      gameContainer.style.display = 'block';
      
      // AI ìƒëŒ€ ì•„ë°”íƒ€ ë³€ê²½
      document.querySelector('.opponent-avatar').innerHTML = 'ğŸ¤–';
      
      initGame();
      showToast('info', 'AI ëª¨ë“œë¡œ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤. ë‚œì´ë„: ' + aiDifficulty);
      
      // ê²Œì„ íƒ€ì´ë¨¸ ì‹œì‘
      startGameTimer();
    }
    
    function setupP2PConnection() {
      menuScreen.classList.add('hidden');
      signalPanel.style.display = 'block';
      
      const isHost = p2pRole === 'host';
      const connectionStatus = document.getElementById('connectionStatus');
      
      connectionStatus.className = 'connection-status status-connecting';
      connectionStatus.innerHTML = '<div class="loader"></div> ì—°ê²° ëŒ€ê¸° ì¤‘...';
      
      if (isHost) {
        document.getElementById('signalInstructions').innerHTML = 
          '<strong>ë°©ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.</strong><br>ì•„ë˜ ì—°ê²° ì½”ë“œë¥¼ ì¹œêµ¬ì—ê²Œ ê³µìœ í•˜ì„¸ìš”.';
      } else {
        document.getElementById('signalInstructions').innerHTML = 
          '<strong>ë°©ì— ì°¸ê°€í•©ë‹ˆë‹¤.</strong><br>í˜¸ìŠ¤íŠ¸ì˜ ì—°ê²° ì½”ë“œë¥¼ ì•„ë˜ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.';
      }
      
      // P2P ì—°ê²° ì´ˆê¸°í™”
      peer = new SimplePeer({
        initiator: isHost,
        trickle: false
      });
      
      // ì‹œê·¸ë„ë§ ë°ì´í„° ìƒì„± ì‹œ
      peer.on('signal', data => {
        const signalData = document.getElementById('signalData');
        signalData.value = JSON.stringify(data);
        
        // QR ì½”ë“œ ìƒì„± (í˜¸ìŠ¤íŠ¸ì¸ ê²½ìš°)
        if (isHost) {
          generateQRCode(signalData.value);
        }
      });
      
      // ì—°ê²° ì„±ê³µ ì‹œ
      peer.on('connect', () => {
        connectionEstablished = true;
        connectionStatus.className = 'connection-status status-connected';
        connectionStatus.innerHTML = '<span class="icon">âœ“</span> ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!';
        
        setTimeout(() => {
          signalPanel.style.display = 'none';
          gameContainer.style.display = 'block';
          
          // ìƒëŒ€ë°© ì•„ë°”íƒ€ ë³€ê²½
          document.querySelector('.opponent-avatar').innerHTML = 'ğŸ‘¤';
          
          showToast('success', 'ìƒëŒ€ë°©ê³¼ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤!');
          
          // ê²Œì„ ì´ˆê¸°í™” (í˜¸ìŠ¤íŠ¸ë§Œ)
          if (isHost) {
            initGame();
            sendGameState();
          }
          
          // ê²Œì„ íƒ€ì´ë¨¸ ì‹œì‘
          startGameTimer();
        }, 1000);
      });
      
      // ë°ì´í„° ìˆ˜ì‹  ì‹œ
      peer.on('data', data => {
        try {
          const message = JSON.parse(data.toString());
          handleP2PMessage(message);
        } catch (e) {
          console.error('Invalid message received:', e);
        }
      });
      
      // ì—ëŸ¬ ë°œìƒ ì‹œ
      peer.on('error', err => {
        console.error('P2P connection error:', err);
        connectionStatus.className = 'connection-status status-error';
        connectionStatus.innerHTML = '<span class="icon">âš ï¸</span> ì—°ê²° ì˜¤ë¥˜: ' + err.message;
        
        // ìë™ ì¬ì—°ê²° ì‹œë„
        if (reconnectAttempts < MAX_RECONNECT_ATTEMPTS) {
          reconnectAttempts++;
          showToast('warning', `ì—°ê²° ì˜¤ë¥˜. ì¬ì—°ê²° ì‹œë„ ì¤‘... (${reconnectAttempts}/${MAX_RECONNECT_ATTEMPTS})`);
          setTimeout(() => setupP2PConnection(), 2000);
        } else {
          showToast('error', 'ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.');
          setTimeout(backToMenu, 2000);
        }
      });
    }
    
    function sendSignalData() {
      try {
        const signalData = document.getElementById('signalData');
        const data = JSON.parse(signalData.value);
        peer.signal(data);
        
        const connectionStatus = document.getElementById('connectionStatus');
        connectionStatus.innerHTML = '<div class="loader"></div> ì—°ê²° ì¤‘...';
        
        showToast('info', 'ì—°ê²° ì‹œë„ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.');
      } catch (e) {
        showToast('error', 'ì˜¬ë°”ë¥¸ ì—°ê²° ì½”ë“œê°€ ì•„ë‹™ë‹ˆë‹¤.');
      }
    }
    
    function copySignalData() {
      const signalData = document.getElementById('signalData');
      signalData.select();
      document.execCommand('copy');
      showToast('success', 'ì—°ê²° ì½”ë“œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    function generateQRCode(data) {
      const qrContainer = document.getElementById('qrContainer');
      qrContainer.innerHTML = '';
      
      new QRCode(qrContainer, {
        text: data,
        width: 180,
        height: 180,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.L
      });
    }
    
    function cancelConnection() {
      if (peer) {
        peer.destroy();
      }
      backToMenu();
    }
    
    function initGame() {
      // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
      deck = [];
      discardPile = [];
      myHand = [];
      opponentHand = [];
      opponentCardCount = 0;
      currentTurn = 'player'; // í”Œë ˆì´ì–´ë¶€í„° ì‹œì‘
      lastCardDrawn = false;
      canCallUno = false;
      unoWasCalled = false;
      cardsPlayedCount = 0;
      cardsDrawnCount = 0;
      
      // ë± ìƒì„± ë° ì„ê¸°
      createDeck();
      deck = shuffle(deck);
      
      // ì¹´ë“œ ë¶„ë°° (ê° 7ì¥)
      for (let i = 0; i < 7; i++) {
        myHand.push(deck.pop());
        if (gameMode === 'ai') {
          opponentHand.push(deck.pop());
        } else {
          opponentCardCount++;
        }
      }
      
      // ì²« ì¹´ë“œ ì„¤ì • (ì™€ì¼ë“œ ì¹´ë“œê°€ ì•„ë‹ˆë„ë¡)
      let firstCard = deck.pop();
      while (firstCard.type === 'wild') {
        deck.unshift(firstCard); // ë± ë°‘ìœ¼ë¡œ
        firstCard = deck.pop();
      }
      
      discardPile.push(firstCard);
      currentColor = firstCard.color;
      currentValue = firstCard.value;
      
      // ê²Œì„ ì‹œì‘
      gameStarted = true;
      
      // UI ì—…ë°ì´íŠ¸
      updateGameUI();
      
      // AI ëª¨ë“œì´ê³  ìƒëŒ€ ì°¨ë¡€ë©´ AI í„´ ì‹¤í–‰
      if (gameMode === 'ai' && currentTurn === 'opponent') {
        setTimeout(playAITurn, getAIThinkingTime());
      }
    }
    
    /* ========== ë± ìƒì„± ë° ê´€ë¦¬ ========== */
    function createDeck() {
      deck = [];
      
      // ì¼ë°˜ ìˆ«ì ì¹´ë“œ (0ì€ ê° ìƒ‰ìƒë³„ 1ì¥, 1-9ëŠ” ê° 2ì¥)
      colors.forEach(color => {
        // 0ì€ ê° ìƒ‰ìƒë‹¹ 1ì¥ë§Œ
        deck.push({color, value: "0", type: "number"});
        
        // 1-9ëŠ” ê° ìƒ‰ìƒë‹¹ 2ì¥ì”©
        for (let n = 1; n <= 9; n++) {
          deck.push({color, value: n.toString(), type: "number"});
          deck.push({color, value: n.toString(), type: "number"});
        }
        
        // íŠ¹ìˆ˜ ì¹´ë“œ (ê±´ë„ˆë›°ê¸°, ë’¤ì§‘ê¸°, 2ì¥ ë½‘ê¸°) ê° 2ì¥ì”©
        specialTypes.forEach(special => {
          deck.push({color, value: special, type: "special"});
          deck.push({color, value: special, type: "special"});
        });
      });
      
      // ì™€ì¼ë“œ ì¹´ë“œ (ìƒ‰ìƒ ë³€ê²½, 4ì¥ ë½‘ê¸°) ê° 4ì¥
      wildTypes.forEach(wild => {
        for (let i = 0; i < 4; i++) {
          deck.push({color: "wild", value: wild, type: "wild"});
        }
      });
    }
    
    function shuffle(array) {
      const newArray = [...array];
      for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
      }
      return newArray;
    }
    
    function reshuffleDiscardPile() {
      // ë§ˆì§€ë§‰ ì¹´ë“œ ì €ì¥
      const lastCard = discardPile.pop();
      
      // ë‚˜ë¨¸ì§€ ë²„ë¦¼ íŒŒì¼ì„ ì„ì–´ì„œ ë“œë¡œìš° íŒŒì¼ë¡œ
      deck = shuffle(discardPile);
      discardPile = [lastCard];
      
      showToast('info', 'ë²„ë¦¼ íŒŒì¼ì„ ì„ì–´ ë“œë¡œìš° íŒŒì¼ë¡œ ì¬êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.');
    }
    
    /* ========== ê²Œì„ í”Œë ˆì´ ë¡œì§ ========== */
    function playerPlay(cardIndex) {
      if (currentTurn !== 'player') return;
      
      const card = myHand[cardIndex];
      
      if (isPlayable(card)) {
        // ì¹´ë“œ ì´ë™ ì• ë‹ˆë©”ì´ì…˜
        const cardElement = document.querySelector(`#playerHand .card-player:nth-child(${cardIndex + 1})`);
        animateCardPlay(cardElement, () => {
          // ì¹´ë“œ í”Œë ˆì´ ë¡œì§
          playCard(card, cardIndex);
          
          // ì‚¬ìš´ë“œ ì¬ìƒ
          playSound('cardPlay');
          
          // ë‚¨ì€ ì¹´ë“œê°€ í•˜ë‚˜ë©´ UNO ë²„íŠ¼ í™œì„±í™”
          if (myHand.length === 1) {
            canCallUno = true;
            document.getElementById('unoBtn').disabled = false;
            
            // ìë™ìœ¼ë¡œ UNO ì™¸ì¹˜ì§€ ì•ŠìŒ - ë²„íŠ¼ ëˆŒëŸ¬ì•¼ í•¨
            showToast('warning', 'UNO ë²„íŠ¼ì„ ëˆŒëŸ¬ "UNO!"ë¥¼ ì™¸ì¹˜ì„¸ìš”!');
          }
          
          // ëª¨ë“  ì¹´ë“œë¥¼ ëƒˆìœ¼ë©´ ê²Œì„ ì¢…ë£Œ
          if (myHand.length === 0) {
            endGame('player');
            return;
          }
          
          // íŠ¹ìˆ˜ ì¹´ë“œ íš¨ê³¼ ì²˜ë¦¬
          if (card.type === 'special') {
            if (card.value === 'skip' || card.value === 'reverse') {
              // 2ì¸ ê²Œì„ì—ì„œëŠ” ìƒëŒ€ë°© í„´ ìŠ¤í‚µ (ë‹¤ì‹œ ë‚´ ì°¨ë¡€)
              showToast('info', 'ìƒëŒ€ì˜ í„´ì„ ê±´ë„ˆëœë‹ˆë‹¤!');
              currentTurn = 'player';
            } else if (card.value === 'draw2') {
              // ìƒëŒ€ë°© 2ì¥ ë½‘ê¸°
              if (gameMode === 'ai') {
                for (let i = 0; i < 2; i++) {
                  if (deck.length === 0) reshuffleDiscardPile();
                  opponentHand.push(deck.pop());
                }
              } else {
                // P2P ëª¨ë“œì—ì„œëŠ” ìƒëŒ€ë°©ì—ê²Œ ì•Œë¦¼
                sendGameAction({
                  action: 'drawCards',
                  count: 2
                });
              }
              showToast('info', 'ìƒëŒ€ë°©ì´ 2ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤!');
            }
          } else if (card.type === 'wild') {
            // ì™€ì¼ë“œ ì¹´ë“œ íš¨ê³¼ ì²˜ë¦¬
            if (card.value === 'wild') {
              // ìƒ‰ìƒ ì„ íƒ í›„ ì²˜ë¦¬ ì™„ë£Œë¨
            } else if (card.value === 'draw4') {
              // ìƒëŒ€ë°© 4ì¥ ë½‘ê¸°
              if (gameMode === 'ai') {
                for (let i = 0; i < 4; i++) {
                  if (deck.length === 0) reshuffleDiscardPile();
                  opponentHand.push(deck.pop());
                }
              } else {
                // P2P ëª¨ë“œì—ì„œëŠ” ìƒëŒ€ë°©ì—ê²Œ ì•Œë¦¼
                sendGameAction({
                  action: 'drawCards',
                  count: 4
                });
              }
              showToast('info', 'ìƒëŒ€ë°©ì´ 4ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤!');
            }
          }
          
          // P2P ëª¨ë“œì—ì„œ ìƒëŒ€ë°©ì—ê²Œ ì•¡ì…˜ ì „ì†¡
          if (gameMode === 'p2p') {
            sendGameAction({
              action: 'playCard',
              card: card
            });
          }
          
          // í„´ ì¢…ë£Œ
          lastCardDrawn = false;
          endTurn();
        });
      } else {
        showToast('error', 'ì´ ì¹´ë“œëŠ” ë‚¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
      }
    }
    
    function playCard(card, index) {
      // í•´ë‹¹ ì¹´ë“œë¥¼ ì†ì—ì„œ ì œê±°
      if (index !== undefined) {
        if (currentTurn === 'player') {
          myHand.splice(index, 1);
        } else if (gameMode === 'ai') {
          opponentHand.splice(index, 1);
        }
      }
      
      // ì™€ì¼ë“œ ì¹´ë“œì¸ ê²½ìš° ìƒ‰ìƒ ì„ íƒ
      if (card.type === 'wild' && currentTurn === 'player') {
        showColorSelector();
        // ì„ íƒ í”„ë¡œì„¸ìŠ¤ëŠ” selectWildColor í•¨ìˆ˜ì—ì„œ ê³„ì†ë¨
        return;
      } else if (card.type === 'wild' && currentTurn === 'opponent' && gameMode === 'ai') {
        // AIëŠ” ìì‹ ì˜ ì†ì— ê°€ì¥ ë§ì€ ìƒ‰ìƒì„ ì„ íƒ
        const colorCounts = {};
        colors.forEach(c => colorCounts[c] = 0);
        
        opponentHand.forEach(c => {
          if (c.color !== 'wild') {
            colorCounts[c.color]++;
          }
        });
        
        let maxColor = colors[0];
        let maxCount = colorCounts[maxColor];
        
        colors.forEach(c => {
          if (colorCounts[c] > maxCount) {
            maxColor = c;
            maxCount = colorCounts[c];
          }
        });
        
        card.chosenColor = maxColor;
      }
      
      // ì¹´ë“œë¥¼ ë²„ë¦¼ íŒŒì¼ì— ì¶”ê°€
      discardPile.push(card);
      
      // í˜„ì¬ ìƒ‰ìƒ ë° ê°’ ì—…ë°ì´íŠ¸
      currentColor = card.type === 'wild' ? card.chosenColor : card.color;
      currentValue = card.value;
      
      // ì¹´ë“œ ë‚¸ íšŸìˆ˜ ì¦ê°€
      cardsPlayedCount++;
      
      // UI ì—…ë°ì´íŠ¸
      updateGameUI();
    }
    
    function showColorSelector() {
      colorSelector.style.display = 'block';
    }
    
    function selectWildColor(color) {
      // ë§ˆì§€ë§‰ ë²„ë¦¼ íŒŒì¼ì˜ ì¹´ë“œ ìƒ‰ìƒ ì„¤ì •
      const lastCard = discardPile[discardPile.length - 1];
      lastCard.chosenColor = color;
      
      // í˜„ì¬ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
      currentColor = color;
      
      // ìƒ‰ìƒ ì„ íƒê¸° ë‹«ê¸°
      colorSelector.style.display = 'none';
      
      // UI ì—…ë°ì´íŠ¸
      updateGameUI();
      
      // í„´ ì¢…ë£Œ
      endTurn();
    }
    
    function isPlayable(card) {
      if (!card) return false;
      
      // ì™€ì¼ë“œ ì¹´ë“œëŠ” í•­ìƒ ë‚¼ ìˆ˜ ìˆìŒ
      if (card.type === 'wild') return true;
      
      // ê°™ì€ ìƒ‰ìƒ ë˜ëŠ” ê°™ì€ ê°’/íƒ€ì…ì˜ ì¹´ë“œ ë‚¼ ìˆ˜ ìˆìŒ
      return card.color === currentColor || 
             (card.type === 'number' && card.value === currentValue) ||
             (card.type === 'special' && card.value === currentValue);
    }
    
    function playerDrawCard() {
      if (currentTurn !== 'player' || lastCardDrawn) return;
      
      // ë±ì´ ë¹„ì—ˆìœ¼ë©´ ë²„ë¦¼ íŒŒì¼ ë‹¤ì‹œ ì„ê¸°
      if (deck.length === 0) {
        reshuffleDiscardPile();
      }
      
      // ì¹´ë“œ ë½‘ê¸°
      const drawnCard = deck.pop();
      myHand.push(drawnCard);
      cardsDrawnCount++;
      
      // ë½‘ì€ ì¹´ë“œ íš¨ê³¼
      playSound('cardDraw');
      
      // ë½‘ì€ ì¹´ë“œë¥¼ ë‚¼ ìˆ˜ ìˆìœ¼ë©´ ë°”ë¡œ ë‚¼ ìˆ˜ ìˆê²Œ í•¨
      lastCardDrawn = true;
      
      // íŒ¨ìŠ¤ ë²„íŠ¼ í™œì„±í™”
      document.getElementById('passBtn').disabled = false;
      
      // P2P ëª¨ë“œì—ì„œ ìƒëŒ€ë°©ì—ê²Œ ì•Œë¦¼
      if (gameMode === 'p2p') {
        sendGameAction({
          action: 'drawCard'
        });
      }
      
      // ë½‘ì€ ì¹´ë“œ í‘œì‹œ
      showToast('info', `ì¹´ë“œë¥¼ ë½‘ì•˜ìŠµë‹ˆë‹¤: ${getCardName(drawnCard)}`);
      
      // UI ì—…ë°ì´íŠ¸
      updateGameUI();
      
      // ë½‘ì€ ì¹´ë“œë¥¼ ë‚¼ ìˆ˜ ìˆëŠ”ì§€ í™•ì¸í•˜ê³  ì‹œê°ì  í‘œì‹œ
      if (isPlayable(drawnCard)) {
        const lastCardElement = document.querySelector('#playerHand .card-player:last-child');
        if (lastCardElement) {
          lastCardElement.querySelector('.card').classList.add('can-play');
        }
      }
    }
    
    function getCardName(card) {
      if (card.type === 'number') {
        return `${card.color} ${card.value}`;
      } else if (card.type === 'special') {
        let specialName = '';
        if (card.value === 'skip') specialName = 'ê±´ë„ˆë›°ê¸°';
        else if (card.value === 'reverse') specialName = 'ë°©í–¥ ì „í™˜';
        else if (card.value === 'draw2') specialName = '2ì¥ ë½‘ê¸°';
        return `${card.color} ${specialName}`;
      } else if (card.type === 'wild') {
        return card.value === 'wild' ? 'ìƒ‰ìƒ ë³€ê²½' : '4ì¥ ë½‘ê¸°';
      }
      return '';
    }
    
    function passTurn() {
      if (currentTurn !== 'player' || !lastCardDrawn) return;
      
      document.getElementById('passBtn').disabled = true;
      lastCardDrawn = false;
      endTurn();
    }
    
    function callUno() {
      if (!canCallUno) return;
      
      unoWasCalled = true;
      canCallUno = false;
      document.getElementById('unoBtn').disabled = true;
      
      playSound('uno');
      showToast('warning', 'í”Œë ˆì´ì–´: "UNO!"', 1500);
      
      // P2P ëª¨ë“œì—ì„œ ìƒëŒ€ë°©ì—ê²Œ ì•Œë¦¼
      if (gameMode === 'p2p') {
        sendGameAction({
          action: 'calledUno'
        });
      }
      
      // UI íš¨ê³¼
      const messageElement = document.getElementById('message');
      messageElement.textContent = 'UNO!';
      messageElement.classList.add('highlight');
      
      setTimeout(() => {
        messageElement.classList.remove('highlight');
      }, 1500);
    }
    
    function endTurn() {
      // ìš°ë…¸ ì½œ ì²´í¬ (1ì¥ ë‚¨ì•˜ëŠ”ë° UNO ì™¸ì¹˜ì§€ ì•Šìœ¼ë©´ 2ì¥ ë½‘ê¸°)
      if (currentTurn === 'player' && myHand.length === 1 && !unoWasCalled) {
        showToast('error', 'UNOë¥¼ ì™¸ì¹˜ì§€ ì•Šì•„ 2ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ìŠµë‹ˆë‹¤!');
        
        // 2ì¥ ì¶”ê°€
        for (let i = 0; i < 2; i++) {
          if (deck.length === 0) reshuffleDiscardPile();
          myHand.push(deck.pop());
          cardsDrawnCount++;
        }
        
        playSound('warning');
      }
      
      // UNO ì½œ ìƒíƒœ ì´ˆê¸°í™”
      canCallUno = false;
      unoWasCalled = false;
      document.getElementById('unoBtn').disabled = true;
      
      // í„´ ì „í™˜
      currentTurn = currentTurn === 'player' ? 'opponent' : 'player';
      
      // UI ì—…ë°ì´íŠ¸
      updateGameUI();
      
      // ìƒëŒ€ í„´ì´ë©´ AI ë˜ëŠ” ëŒ€ê¸°
      if (currentTurn === 'opponent') {
        if (gameMode === 'ai') {
          // AI í„´ ì‹¤í–‰ (ì§€ì—° ì‹œê°„ ì¶”ê°€)
          setTimeout(playAITurn, getAIThinkingTime());
        }
      }
    }
    
    /* ========== AI ë¡œì§ ========== */
    function playAITurn() {
      if (currentTurn !== 'opponent' || gameMode !== 'ai') return;
      
      // AI ìƒê° ì¤‘ í‘œì‹œ
      const opponentStatus = document.querySelector('.opponent-status');
      opponentStatus.classList.add('thinking');
      
      // ì‹¤ì œ AI í–‰ë™ ì§€ì—°
      setTimeout(() => {
        // ë‚¼ ìˆ˜ ìˆëŠ” ì¹´ë“œ ì°¾ê¸°
        const playableCards = opponentHand.map((card, index) => ({ card, index }))
                                         .filter(item => isPlayable(item.card));
        
        if (playableCards.length > 0) {
          // ì¹´ë“œ ë‚´ê¸° (AI ì „ëµì— ë”°ë¼ ì¹´ë“œ ì„ íƒ)
          const cardChoice = selectAICard(playableCards);
          
          // ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ ë° í”Œë ˆì´
          const randomOpponentCard = document.querySelector('.opponent-card');
          animateCardPlay(randomOpponentCard, () => {
            playCard(cardChoice.card, cardChoice.index);
            playSound('cardPlay');
            
            // UNO ì²´í¬ (AIëŠ” í•­ìƒ UNO ì™¸ì¹¨)
            if (opponentHand.length === 1) {
              showToast('warning', 'ìƒëŒ€: "UNO!"', 1500);
              playSound('uno');
            }
            
            // ëª¨ë“  ì¹´ë“œ ëƒˆëŠ”ì§€ ì²´í¬
            if (opponentHand.length === 0) {
              endGame('opponent');
              return;
            }
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸ ë° í„´ ì¢…ë£Œ
            opponentStatus.classList.remove('thinking');
            endTurn();
          });
        } else {
          // ë‚¼ ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìœ¼ë©´ ë“œë¡œìš°
          if (deck.length === 0) {
            reshuffleDiscardPile();
          }
          
          // ì¹´ë“œ ë½‘ê¸°
          const drawnCard = deck.pop();
          opponentHand.push(drawnCard);
          
          // ë½‘ì€ ì¹´ë“œ í‘œì‹œ (ë‚œì´ë„ì— ë”°ë¼ ì •ë³´ í‘œì‹œ ì—¬ë¶€ ê²°ì •)
          if (aiDifficulty === 'easy') {
            showToast('info', `ìƒëŒ€ê°€ ì¹´ë“œë¥¼ ë½‘ì•˜ìŠµë‹ˆë‹¤: ${getCardName(drawnCard)}`);
          } else {
            showToast('info', 'ìƒëŒ€ê°€ ì¹´ë“œë¥¼ ë½‘ì•˜ìŠµë‹ˆë‹¤.');
          }
          
          playSound('cardDraw');
          
          // ë½‘ì€ ì¹´ë“œë¥¼ ë‚¼ ìˆ˜ ìˆìœ¼ë©´ ë‚´ê¸°
          if (isPlayable(drawnCard)) {
            setTimeout(() => {
              const randomOpponentCard = document.querySelector('.opponent-card');
              animateCardPlay(randomOpponentCard, () => {
                playCard(drawnCard, opponentHand.length - 1);
                playSound('cardPlay');
                
                // UNO ì²´í¬
                if (opponentHand.length === 1) {
                  showToast('warning', 'ìƒëŒ€: "UNO!"', 1500);
                  playSound('uno');
                }
                
                // ëª¨ë“  ì¹´ë“œ ëƒˆëŠ”ì§€ ì²´í¬
                if (opponentHand.length === 0) {
                  endGame('opponent');
                  return;
                }
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸ ë° í„´ ì¢…ë£Œ
                opponentStatus.classList.remove('thinking');
                endTurn();
              });
            }, 800);
          } else {
            // ë‚¼ ìˆ˜ ì—†ìœ¼ë©´ í„´ ì¢…ë£Œ
            opponentStatus.classList.remove('thinking');
            endTurn();
          }
        }
      }, 1000);
    }
    
    function selectAICard(playableCards) {
      // AI ë‚œì´ë„ì— ë”°ë¥¸ ì¹´ë“œ ì„ íƒ ì „ëµ
      if (aiDifficulty === 'easy') {
        // ì‰¬ì›€: ëœë¤ ì„ íƒ
        return playableCards[Math.floor(Math.random() * playableCards.length)];
      } else if (aiDifficulty === 'medium') {
        // ë³´í†µ: ìˆ«ì ì¹´ë“œ ìš°ì„ , ê°™ì€ ìˆ«ì ì¹´ë“œë©´ ëœë¤
        const numberCards = playableCards.filter(item => item.card.type === 'number');
        
        if (numberCards.length > 0) {
          return numberCards[Math.floor(Math.random() * numberCards.length)];
        }
        
        // ìˆ«ì ì¹´ë“œê°€ ì—†ìœ¼ë©´ ê·¸ëƒ¥ ëœë¤
        return playableCards[Math.floor(Math.random() * playableCards.length)];
      } else {
        // ì–´ë ¤ì›€: íŠ¹ìˆ˜ ì¹´ë“œ ìš°ì„ , ë‹¤ìŒìœ¼ë¡œ ì™€ì¼ë“œ, ë§ˆì§€ë§‰ìœ¼ë¡œ ìˆ«ì
        // ì™€ì¼ë“œ ì¹´ë“œ
        const wildCards = playableCards.filter(item => item.card.type === 'wild');
        // íŠ¹ìˆ˜ ì¹´ë“œ
        const specialCards = playableCards.filter(item => item.card.type === 'special');
        // ìˆ«ì ì¹´ë“œ
        const numberCards = playableCards.filter(item => item.card.type === 'number');
        
        if (specialCards.length > 0) {
          return specialCards[Math.floor(Math.random() * specialCards.length)];
        } else if (wildCards.length > 0) {
          return wildCards[Math.floor(Math.random() * wildCards.length)];
        } else {
          return numberCards[Math.floor(Math.random() * numberCards.length)];
        }
      }
    }
    
    function getAIThinkingTime() {
      // ë‚œì´ë„ì— ë”°ë¥¸ AI ìƒê° ì‹œê°„
      if (aiDifficulty === 'easy') {
        return 1000 + Math.random() * 1000; // 1-2ì´ˆ
      } else if (aiDifficulty === 'medium') {
        return 800 + Math.random() * 700; // 0.8-1.5ì´ˆ
      } else {
        return 500 + Math.random() * 500; // 0.5-1ì´ˆ
      }
    }
    
    /* ========== P2P í†µì‹  ë¡œì§ ========== */
    function sendGameAction(action) {
      if (gameMode !== 'p2p' || !connectionEstablished) return;
      
      peer.send(JSON.stringify({
        type: 'gameAction',
        action: action
      }));
    }
    
    function sendGameState() {
      if (gameMode !== 'p2p' || !connectionEstablished) return;
      
      peer.send(JSON.stringify({
        type: 'gameState',
        state: {
          deck: deck,
          discardPile: discardPile,
          currentTurn: currentTurn,
          currentColor: currentColor,
          currentValue: currentValue,
          opponentHand: myHand, // ë‚´ ì† ì¹´ë“œê°€ ìƒëŒ€ë°©ì—ê²ŒëŠ” ìƒëŒ€ ì¹´ë“œ
          opponentCardCount: myHand.length
        }
      }));
    }
    
    function handleP2PMessage(message) {
      if (!message || !message.type) return;
      
      switch (message.type) {
        case 'gameState':
          // ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (í´ë¼ì´ì–¸íŠ¸ê°€ ë°›ìŒ)
          deck = message.state.deck;
          discardPile = message.state.discardPile;
          currentTurn = message.state.currentTurn === 'player' ? 'opponent' : 'player';
          currentColor = message.state.currentColor;
          currentValue = message.state.currentValue;
          opponentHand = message.state.opponentHand;
          opponentCardCount = message.state.opponentCardCount;
          
          // UI ì—…ë°ì´íŠ¸
          updateGameUI();
          break;
          
        case 'gameAction':
          handleOpponentAction(message.action);
          break;
      }
    }
    
    function handleOpponentAction(action) {
      if (!action || !action.action) return;
      
      switch (action.action) {
        case 'playCard':
          // ìƒëŒ€ë°©ì´ ì¹´ë“œë¥¼ ëƒ„
          const card = action.card;
          opponentCardCount--;
          
          // ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒ
          const randomOpponentCard = document.querySelector('.opponent-card');
          animateCardPlay(randomOpponentCard, () => {
            // ë²„ë¦¼ íŒŒì¼ì— ì¹´ë“œ ì¶”ê°€
            discardPile.push(card);
            
            // í˜„ì¬ ìƒ‰ìƒ ë° ê°’ ì—…ë°ì´íŠ¸
            currentColor = card.type === 'wild' ? card.chosenColor : card.color;
            currentValue = card.value;
            
            // íš¨ê³¼ ì²˜ë¦¬
            if (card.type === 'special') {
              if (card.value === 'skip' || card.value === 'reverse') {
                // ë‚´ í„´ ìŠ¤í‚µ
                showToast('info', 'ìƒëŒ€ê°€ ë‹¹ì‹ ì˜ í„´ì„ ê±´ë„ˆëœë‹ˆë‹¤!');
                currentTurn = 'opponent';
              } else if (card.value === 'draw2') {
                // 2ì¥ ë½‘ê¸°
                showToast('info', 'ë‹¹ì‹ ì€ 2ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ì•„ì•¼ í•©ë‹ˆë‹¤!');
                for (let i = 0; i < 2; i++) {
                  if (deck.length === 0) reshuffleDiscardPile();
                  myHand.push(deck.pop());
                  cardsDrawnCount++;
                }
              }
            } else if (card.type === 'wild' && card.value === 'draw4') {
              // 4ì¥ ë½‘ê¸°
              showToast('info', 'ë‹¹ì‹ ì€ 4ì¥ì˜ ì¹´ë“œë¥¼ ë½‘ì•„ì•¼ í•©ë‹ˆë‹¤!');
              for (let i = 0; i < 4; i++) {
                if (deck.length === 0) reshuffleDiscardPile();
                myHand.push(deck.pop());
                cardsDrawnCount++;
              }
            }
            
            // ì‚¬ìš´ë“œ ì¬ìƒ
            playSound('cardPlay');
            
            // UI ì—…ë°ì´íŠ¸
            updateGameUI();
            
            // í„´ ì‹œì‘ (ë‚´ í„´ì´ë©´)
            if (currentTurn === 'player') {
              // íŒ¨ìŠ¤í•  ê²ƒì€ ì—†ìœ¼ë¯€ë¡œ ì²˜ìŒ ìƒíƒœë¡œ
              lastCardDrawn = false;
              document.getElementById('passBtn').disabled = true;
            }
          });
          break;
          
        case 'drawCard':
          // ìƒëŒ€ë°©ì´ ì¹´ë“œë¥¼ ë½‘ìŒ
          opponentCardCount++;
          showToast('info', 'ìƒëŒ€ê°€ ì¹´ë“œë¥¼ ë½‘ì•˜ìŠµë‹ˆë‹¤.');
          playSound('cardDraw');
          updateGameUI();
          break;
          
        case 'drawCards':
          // ë‚´ê°€ ì—¬ëŸ¬ ì¥ ë½‘ì•„ì•¼ í•¨ (draw2, draw4 íš¨ê³¼)
          const count = action.count || 0;
          for (let i = 0; i < count; i++) {
            if (deck.length === 0) reshuffleDiscardPile();
            myHand.push(deck.pop());
            cardsDrawnCount++;
          }
          updateGameUI();
          break;
          
        case 'calledUno':
          // ìƒëŒ€ë°©ì´ UNO ì™¸ì¹¨
          showToast('warning', 'ìƒëŒ€: "UNO!"', 1500);
          playSound('uno');
          
          // UI íš¨ê³¼
          const messageElement = document.getElementById('message');
          messageElement.textContent = 'ìƒëŒ€ê°€ UNO!';
          messageElement.classList.add('highlight');
          
          setTimeout(() => {
            messageElement.classList.remove('highlight');
          }, 1500);
          break;
      }
    }
    
    /* ========== UI ì—…ë°ì´íŠ¸ ========== */
    function updateGameUI() {
      renderPlayerHand();
      renderOpponentHand();
      renderDiscardPile();
      renderDeckCount();
      updateTurnDisplay();
      updateMessage();
    }
    
    function renderPlayerHand() {
      const handContainer = document.getElementById('playerHand');
      handContainer.innerHTML = '';
      
      // ì¹´ë“œ ì •ë ¬ (ìˆ«ì > íŠ¹ìˆ˜ > ì™€ì¼ë“œ, ìƒ‰ìƒë³„)
      const sortedHand = [...myHand].sort((a, b) => {
        if (a.type !== b.type) {
          if (a.type === 'number') return -1;
          if (b.type === 'number') return 1;
          if (a.type === 'special') return -1;
          if (b.type === 'special') return 1;
        }
        if (a.color !== b.color) {
          return colors.indexOf(a.color) - colors.indexOf(b.color);
        }
        if (a.type === 'number') {
          return parseInt(a.value) - parseInt(b.value);
        }
        return 0;
      });
      
      sortedHand.forEach((card, index) => {
        const cardWrapper = document.createElement('div');
        cardWrapper.className = 'card-player';
        
        const cardElement = document.createElement('div');
        cardElement.className = `card ${card.color}`;
        
        // ì¹´ë“œ ë‚´ìš©ë¬¼
        const cardContent = document.createElement('div');
        cardContent.className = 'card-content';
        
        // ì¹´ë“œ ëª¨ì„œë¦¬ í‘œì‹œ
        const cardCorner = document.createElement('div');
        cardCorner.className = 'card-corners';
        cardCorner.textContent = getCardIcon(card);
        
        const cardCornerBR = document.createElement('div');
        cardCornerBR.className = 'card-corners-br';
        cardCornerBR.textContent = getCardIcon(card);
        
        cardContent.textContent = getCardIcon(card);
        cardContent.appendChild(cardCorner);
        cardContent.appendChild(cardCornerBR);
        
        cardElement.appendChild(cardContent);
        
        // ì™€ì¼ë“œ ì¹´ë“œì˜ ê²½ìš° ì„ íƒëœ ìƒ‰ìƒ í‘œì‹œ
        if (card.type === 'wild' && card.chosenColor) {
          cardElement.className = `card ${card.chosenColor}`;
        }
        
        // ë‚´ í„´ì´ê³  ì¹´ë“œë¥¼ ë‚¼ ìˆ˜ ìˆëŠ” ê²½ìš° ì‹œê°ì  íš¨ê³¼
        if (currentTurn === 'player' && isPlayable(card)) {
          cardElement.classList.add('can-play');
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ë‚´ í„´ì¼ ë•Œë§Œ í™œì„±í™”)
        if (currentTurn === 'player') {
          cardElement.addEventListener('click', () => playerPlay(index));
        }
        
        cardWrapper.appendChild(cardElement);
        handContainer.appendChild(cardWrapper);
      });
    }
    
    function renderOpponentHand() {
      const opponentCardsContainer = document.getElementById('opponentCards');
      opponentCardsContainer.innerHTML = '';
      
      const count = gameMode === 'ai' ? opponentHand.length : opponentCardCount;
      document.getElementById('opponentInfo').textContent = `ìƒëŒ€ ì¹´ë“œ: ${count}ì¥`;
      
      // ìµœëŒ€ 10ì¥ë§Œ í‘œì‹œ (UI ê³µê°„ ì œí•œ)
      const visibleCount = Math.min(count, 10);
      
      for (let i = 0; i < visibleCount; i++) {
        const cardElement = document.createElement('div');
        cardElement.className = 'opponent-card card-back';
        opponentCardsContainer.appendChild(cardElement);
      }
      
      // ì¹´ë“œê°€ ë§ìœ¼ë©´ +N í˜•íƒœë¡œ í‘œì‹œ
      if (count > 10) {
        const extraElement = document.createElement('div');
        extraElement.className = 'opponent-card card-back';
        extraElement.textContent = `+${count - 10}`;
        opponentCardsContainer.appendChild(extraElement);
      }
      
      // ìƒëŒ€ë°© ìƒíƒœ ì—…ë°ì´íŠ¸
      const opponentStatus = document.querySelector('.opponent-status');
      if (currentTurn === 'opponent') {
        opponentStatus.classList.add('active');
      } else {
        opponentStatus.classList.remove('active');
        opponentStatus.classList.remove('thinking');
      }
    }
    
    function renderDiscardPile() {
      const discardContainer = document.getElementById('discardPile');
      discardContainer.innerHTML = '';
      
      if (discardPile.length > 0) {
        const topCard = discardPile[discardPile.length - 1];
        
        const cardElement = document.createElement('div');
        cardElement.className = `card ${topCard.type === 'wild' && topCard.chosenColor ? topCard.chosenColor : topCard.color}`;
        
        // ì¹´ë“œ ë‚´ìš©ë¬¼
        const cardContent = document.createElement('div');
        cardContent.className = 'card-content';
        
        // ì¹´ë“œ ëª¨ì„œë¦¬ í‘œì‹œ
        const cardCorner = document.createElement('div');
        cardCorner.className = 'card-corners';
        cardCorner.textContent = getCardIcon(topCard);
        
        const cardCornerBR = document.createElement('div');
        cardCornerBR.className = 'card-corners-br';
        cardCornerBR.textContent = getCardIcon(topCard);
        
        cardContent.textContent = getCardIcon(topCard);
        cardContent.appendChild(cardCorner);
        cardContent.appendChild(cardCornerBR);
        
        cardElement.appendChild(cardContent);
        
        discardContainer.appendChild(cardElement);
      }
    }
    
    function renderDeckCount() {
      const drawContainer = document.getElementById('drawPile');
      const deckCountElement = document.getElementById('deckCount');
      drawContainer.innerHTML = '';
      
      const cardBackElement = document.createElement('div');
      cardBackElement.className = 'card card-back';
      
      // ë“œë¡œìš° íŒŒì¼ í´ë¦­ ì´ë²¤íŠ¸ (ë‚´ í„´ì¼ ë•Œë§Œ)
      if (currentTurn === 'player' && !lastCardDrawn) {
        cardBackElement.style.cursor = 'pointer';
        cardBackElement.addEventListener('click', playerDrawCard);
      } else {
        cardBackElement.style.cursor = 'default';
      }
      
      drawContainer.appendChild(cardBackElement);
      deckCountElement.textContent = `${deck.length}ì¥`;
    }
    
    function updateTurnDisplay() {
      const turnIndicator = document.querySelector('.turn-indicator');
      const turnText = document.getElementById('turnText');
      
      if (currentTurn === 'player') {
        turnIndicator.classList.add('active');
        turnText.textContent = 'ë‚´ ì°¨ë¡€';
      } else {
        turnIndicator.classList.remove('active');
        turnText.textContent = 'ìƒëŒ€ ì°¨ë¡€';
      }
    }
    
    function updateMessage() {
      const messageElement = document.getElementById('message');
      
      if (!gameStarted) {
        messageElement.textContent = 'ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...';
        return;
      }
      
      if (currentTurn === 'player') {
        if (lastCardDrawn) {
          const lastCard = myHand[myHand.length - 1];
          if (isPlayable(lastCard)) {
            messageElement.textContent = 'ë½‘ì€ ì¹´ë“œë¥¼ ë‚´ê±°ë‚˜ í„´ì„ ë„˜ê¸°ì„¸ìš”.';
          } else {
            messageElement.textContent = 'ë‚¼ ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. í„´ì„ ë„˜ê¸°ì„¸ìš”.';
          }
        } else {
          const hasPlayableCard = myHand.some(card => isPlayable(card));
          if (hasPlayableCard) {
            messageElement.textContent = 'ì¹´ë“œë¥¼ ë‚´ê±°ë‚˜ ì¹´ë“œë¥¼ ë½‘ìœ¼ì„¸ìš”.';
          } else {
            messageElement.textContent = 'ë‚¼ ìˆ˜ ìˆëŠ” ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. ì¹´ë“œë¥¼ ë½‘ìœ¼ì„¸ìš”.';
          }
        }
      } else {
        messageElement.textContent = 'ìƒëŒ€ì˜ í„´ì…ë‹ˆë‹¤...';
      }
    }
    
    /* ========== ê²Œì„ ê²°ê³¼ ì²˜ë¦¬ ========== */
    function endGame(winner) {
      gameStarted = false;
      gameEndTime = new Date();
      
      // ë°°ê²½ ìŒì•… ì¤‘ì§€
      if (musicEnabled) {
        bgMusic.pause();
      }
      
      // ìŠ¹ë¦¬ íš¨ê³¼ìŒ
      if (winner === 'player') {
        playSound('win');
      } else {
        playSound('lose');
      }
      
      // ê²Œì„ íƒ€ì´ë¨¸ ì¤‘ì§€
      if (gameTimer) {
        clearInterval(gameTimer);
      }
      
      // ê²Œì„ í†µê³„ ì—…ë°ì´íŠ¸
      document.getElementById('gameTime').textContent = formatTime(gameDuration);
      document.getElementById('cardsPlayed').textContent = `${cardsPlayedCount}ì¥`;
      document.getElementById('cardsDrawn').textContent = `${cardsDrawnCount}ì¥`;
      
      // ê²°ê³¼ ëª¨ë‹¬ ì œëª© ì„¤ì •
      const resultTitle = document.querySelector('.result-title');
      if (winner === 'player') {
        resultTitle.textContent = 'ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!';
        resultTitle.className = 'result-title win-message';
        document.querySelector('.modal-content p').textContent = 'ì¶•í•˜í•©ë‹ˆë‹¤! ìƒëŒ€ë³´ë‹¤ ë¨¼ì € ëª¨ë“  ì¹´ë“œë¥¼ ë‚´ì…¨ìŠµë‹ˆë‹¤.';
        
        // ìŠ¹ë¦¬ ì‹œ ìƒ‰ì¢…ì´ íš¨ê³¼
        createConfetti();
      } else {
        resultTitle.textContent = 'íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤!';
        resultTitle.className = 'result-title lose-message';
        document.querySelector('.modal-content p').textContent = 'ì•ˆíƒ€ê¹ë„¤ìš”! ìƒëŒ€ê°€ ë¨¼ì € ëª¨ë“  ì¹´ë“œë¥¼ ëƒˆìŠµë‹ˆë‹¤.';
      }
      
      // ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
      setTimeout(() => {
        gameResultModal.style.display = 'flex';
      }, 1000);
    }
    
    function createConfetti() {
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        
        // ëœë¤ ìƒ‰ìƒ
        const colors = ['#f1c40f', '#e74c3c', '#3498db', '#2ecc71', '#9b59b6'];
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        // ëœë¤ í¬ê¸°
        const size = Math.random() * 10 + 5;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        
        // ëœë¤ ìœ„ì¹˜
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = `-10px`;
        
        // ëœë¤ íšŒì „
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        document.body.appendChild(confetti);
        
        // ì• ë‹ˆë©”ì´ì…˜
        gsap.to(confetti, {
          y: window.innerHeight + 100,
          x: Math.random() * 200 - 100,
          rotation: Math.random() * 720,
          duration: Math.random() * 3 + 2,
          ease: 'power1.out',
          onComplete: () => confetti.remove()
        });
      }
    }
    
    function restartGame() {
      // ê²°ê³¼ ëª¨ë‹¬ ë‹«ê¸°
      gameResultModal.style.display = 'none';
      
      // ê²Œì„ ì¬ì‹œì‘
      if (gameMode === 'ai') {
        initGame();
      } else if (gameMode === 'p2p' && p2pRole === 'host') {
        initGame();
        sendGameState();
      }
      
      // ë°°ê²½ ìŒì•… ì¬ì‹œì‘
      if (musicEnabled) {
        bgMusic.currentTime = 0;
        bgMusic.play().catch(e => console.log('Music play error:', e));
      }
      
      // íƒ€ì´ë¨¸ ì¬ì‹œì‘
      startGameTimer();
      
      // í†µê³„ ì´ˆê¸°í™”
      cardsPlayedCount = 0;
      cardsDrawnCount = 0;
      
      showToast('info', 'ê²Œì„ì„ ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.');
    }
    
    function backToMenu() {
      // ëª¨ë‹¬ ë‹«ê¸°
      gameResultModal.style.display = 'none';
      settingsModal.style.display = 'none';
      
      // P2P ì—°ê²° ì¢…ë£Œ
      if (peer) {
        peer.destroy();
        peer = null;
      }
      
      // ê²Œì„ ì»¨í…Œì´ë„ˆ ìˆ¨ê¸°ê¸°
      gameContainer.style.display = 'none';
      signalPanel.style.display = 'none';
      
      // ë©”ë‰´ í‘œì‹œ
      menuScreen.classList.remove('hidden');
      
      // ê²Œì„ íƒ€ì´ë¨¸ ì¤‘ì§€
      if (gameTimer) {
        clearInterval(gameTimer);
      }
      
      // ë°°ê²½ ìŒì•… ì¤‘ì§€
      if (musicEnabled) {
        bgMusic.pause();
      }
      
      // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
      gameStarted = false;
      reconnectAttempts = 0;
      connectionEstablished = false;
    }
    
    /* ========== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ========== */
    function startGameTimer() {
      gameStartTime = new Date();
      gameDuration = 0;
      
      if (gameTimer) {
        clearInterval(gameTimer);
      }
      
      gameTimer = setInterval(() => {
        const now = new Date();
        gameDuration = Math.floor((now - gameStartTime) / 1000);
      }, 1000);
    }
    
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}ë¶„ ${secs}ì´ˆ`;
    }
    
    function animateCardPlay(cardElement, callback) {
      if (!cardElement) {
        if (callback) callback();
        return;
      }
      
      const discardPileElement = document.querySelector('#discardPile');
      if (!discardPileElement) {
        if (callback) callback();
        return;
      }
      
      const cardRect = cardElement.getBoundingClientRect();
      const discardRect = discardPileElement.getBoundingClientRect();
      
      const cloneCard = cardElement.cloneNode(true);
      cloneCard.style.position = 'fixed';
      cloneCard.style.left = cardRect.left + 'px';
      cloneCard.style.top = cardRect.top + 'px';
      cloneCard.style.width = cardRect.width + 'px';
      cloneCard.style.height = cardRect.height + 'px';
      cloneCard.style.zIndex = '1000';
      cloneCard.style.transition = 'none';
      cloneCard.style.transform = 'none';
      
      document.body.appendChild(cloneCard);
      
      const centerX = discardRect.left + discardRect.width / 2 - cardRect.width / 2;
      const centerY = discardRect.top + discardRect.height / 2 - cardRect.height / 2;
      
      // GSAP ì• ë‹ˆë©”ì´ì…˜
      gsap.to(cloneCard, {
        left: centerX,
        top: centerY,
        rotation: Math.random() * 20 - 10,
        scale: 0.9,
        ease: "power2.out",
        duration: 0.5,
        onComplete: () => {
          cloneCard.remove();
          if (callback) callback();
        }
      });
    }
    
    function toggleSettingsModal() {
      settingsModal.style.display = settingsModal.style.display === 'flex' ? 'none' : 'flex';
      
      // í˜„ì¬ ì„¤ì • í‘œì‹œ
      document.getElementById('soundToggle').checked = soundEnabled;
      document.getElementById('musicToggle').checked = musicEnabled;
      document.getElementById('colorBlindToggle').checked = colorBlindMode;
      document.getElementById('volumeSlider').value = volumeLevel;
      document.getElementById('volumeValue').textContent = `${volumeLevel}%`;
    }
    
    function saveSettings() {
      soundEnabled = document.getElementById('soundToggle').checked;
      musicEnabled = document.getElementById('musicToggle').checked;
      colorBlindMode = document.getElementById('colorBlindToggle').checked;
      volumeLevel = document.getElementById('volumeSlider').value;
      
      // ìƒ‰ì•½ì ëª¨ë“œ ì ìš©
      document.body.classList.toggle('color-blind-mode', colorBlindMode);
      
      // ë³¼ë¥¨ ì ìš©
      updateVolume();
      
      // ë°°ê²½ ìŒì•… ì„¤ì • ì ìš©
      if (musicEnabled) {
        bgMusic.play().catch(e => console.log('Music play error:', e));
      } else {
        bgMusic.pause();
      }
      
      // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
      settingsModal.style.display = 'none';
      
      showToast('success', 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    function showRules() {
      // ê²Œì„ ê·œì¹™ ëª¨ë‹¬ (ê°„ë‹¨í•œ ì•Œë¦¼ìœ¼ë¡œ ëŒ€ì²´)
      showToast('info', 'UNO ê·œì¹™: ê°™ì€ ìƒ‰ìƒì´ë‚˜ ê°™ì€ ìˆ«ì/ê¸°í˜¸ì˜ ì¹´ë“œë¥¼ ë‚´ì•¼ í•©ë‹ˆë‹¤. íŠ¹ìˆ˜ ì¹´ë“œëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤. ì¹´ë“œë¥¼ ëª¨ë‘ ë‚´ë©´ ìŠ¹ë¦¬í•©ë‹ˆë‹¤!');
    }
    
    function showToast(type, message, duration = 3000) {
      const toastContainer = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast';
      
      let icon = '';
      if (type === 'info') icon = 'â„¹ï¸';
      else if (type === 'success') icon = 'âœ…';
      else if (type === 'warning') icon = 'âš ï¸';
      else if (type === 'error') icon = 'âŒ';
      
      toast.innerHTML = `
        <span class="toast-icon toast-${type}">${icon}</span>
        <span>${message}</span>
      `;
      
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, duration);
    }
  </script>
</body>
</html>
